{% extends "layout.html" %}
{% block body %}
<script type="text/javascript">
  var service_result = {{results|tojson}} 

  google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(drawChart);

  function drawChart(results) {
    var dataTable = new google.visualization.DataTable();
    dataTable.addColumn('string', 'Service Type');
    dataTable.addColumn('number', 'Service Fee');

    for(var idx in results){
      var type = results[idx]['serviceType'];
      var sum = results[idx]['valueOfService'];

      type = type.toString();
      dataTable.addRow([type, sum]);
    }

    var options = {
      title: 'Incomes based on provided services'
    };

    var chart = new google.visualization.PieChart(document.getElementById('piechart'));
    chart.draw(dataTable, options);
  };

  $(document).ready(function() {
    drawChart(service_result);

    $('#filterButton').click(function(){
        var from_date = $('#fromDate').val();
        var to_date = $('#toDate').val();

        url = "{{ url_for('api.date_fee_chart') }}" + "?from=" +from_date + "&to=" + to_date;  

        $.get(url, function(result){
          drawChart(result);
        });
      });
      
      $('.date-picker').datepicker({
        autoclose: true,
        todayHighlight: true,
        format: 'dd-mm-yyyy',
    });
  });
</script>

<section id="portofolio">
  <div id="container" align="center">
    <table>
      <tr>
        <td>
          <div id="piechart" style="width: 750px; height: 400px;"></div>
        </td>
        <td>
            <form class="form-horizontal">
                  <div class="form-group col-xs-8">
                    <div class="col-xs-4">
                      <label for="fromDate" class="control-label pull-right">from:</label>
                    </div>
                    <div class="col-xs-8">
                      <input id="fromDate" name="fromDate" class="form-control date-picker" type="text">
                  </div>
                </div>
                <div class="form-group col-xs-8">
                  <div class="col-xs-4">
                    <label for="toDate" class="control-label pull-right">to:</label>
                    </div>
                  <div class="col-xs-8">
                    <input id="toDate" name="toDate" class="form-control date-picker" type="text">
                  </div>
                </div>
                 <div class="col-xs-4">
                    <button type="button" class="form-control" id="filterButton">Filter</button>
                </div>
            </div>
            </form>
        </td>
      </tr>
    </table>
    
  </div>
</section>
{% endblock %}